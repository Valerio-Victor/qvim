---
title: '**Eficiência Orçamentária de Municípios Brasileiros**'
subtitle: '**Alcance dos Objetivos de Desenvolvimento Sustentável**'
author: '**Autores:** <br>[Moisés Vassallo](http://lattes.cnpq.br/8821972747380756) <br>[Rafael Miranda](http://lattes.cnpq.br/4478766390160865) <br>[Victor Valerio](http://lattes.cnpq.br/1989464933096922) <br>[André Medeiros](http://lattes.cnpq.br/4069096016693580) <br>[José Arnaldo Montevechi](http://lattes.cnpq.br/2169751971927037)'
date: '**Última Atualização:** <br>`r format(Sys.Date(), "%d-%m-%Y")`'
output:
  rmdformats::robobook:
    highlight: kate
---

```{r message=FALSE, warning=FALSE, include=FALSE}
# PACOTES: -----------------------------------------------------------------
library(magrittr)
library(ggplot2)
library(ggtext)
library(plotly)
library(crosstalk)
library(DT)


# CONFIGURAÇÕES: -----------------------------------------------------------
plotly_layout <- c('hoverClosestCartesian',
                   'hoverCompareCartesian',
                   'resetScale2d',
                   'zoom2d',
                   'sendDataToCloud',
                   'editInChartStudio',
                   'pan2d',
                   'select2d',
                   'lasso2d',
                   'drawclosedpath',
                   'drawopenpath',
                   'zoomIn2d',
                   'zoomOut2d',
                   'drawcircle',
                   'drawrect',
                   'drawline')


roxo_e <- '#440154FF'
roxo_c <- '#414487FF'
azul <- '#2A788EFF'
verde_e <- '#22A884FF'
verde_c <- '#7AD151FF'
amarelo <- '#FDE725FF'
cor_base <- '#428BCA'
contraste_base <- '#CD6A4C'


# IMPORTAÇÃO: --------------------------------------------------------------
regioes <- geobr::read_region(year = 2020, 
                              showProgress = FALSE)


estados <- geobr::read_state(year = 2020, 
                             showProgress = FALSE)


municipios <- geobr::read_municipal_seat(year = 2010, 
                                         showProgress = FALSE)

base <- readxl::read_xlsx(path = '../dados/20240926dea_final.xlsx',
                          sheet = 1) %>%
  janitor::clean_names() %>% 
  dplyr::mutate(id_municipio = as.numeric(id_municipio))

eficiencia <- readxl::read_xlsx(path = '../dados/resultados_dea_output.xlsx',
                          sheet = 1) %>%
  janitor::clean_names()  

populacao <- populacao <- sidrar::get_sidra(
  api = '/t/4714/n6/all/v/93/p/all') %>%
  janitor::clean_names() %>%
  dplyr::transmute(municipio_codigo = as.numeric(municipio_codigo),
                   pop = valor)


# ARRUMAÇÃO: ---------------------------------------------------------------
mapa_total <- municipios %>% 
  dplyr::left_join(base, by = c('code_muni' = 'id_municipio')) %>% 
  tidyr::drop_na() %>% 
  dplyr::select(code_muni,
                name_muni,
                abbrev_state,
                name_region, 
                geom)

mapa_insumos <- municipios %>% 
  dplyr::left_join(base, by = c('code_muni' = 'id_municipio')) %>% 
  tidyr::drop_na() %>% 
  dplyr::select(code_muni,
                name_muni,
                abbrev_state,
                name_region,
                !dplyr::contains('ODS'),
                !geom) %>%
  as.data.frame() %>% 
  dplyr::select(name_region, 
                name_muni,
                dplyr::contains('per_capta')) %>% 
  tidyr::pivot_longer(cols = !c(name_region,
                                name_muni),
                      names_to = 'insumo',
                      values_to = 'valor') %>% 
  dplyr::arrange(name_muni, desc(valor)) %>% 
  dplyr::mutate(insumo = dplyr::case_when(
    insumo == 'educacao_cultura_per_capta' ~ 'Educação e Cultura',
    insumo == 'saneamento_gestao_ambiental_per_capta' ~ 'Saneamento e Gestão Ambiental',
    insumo == 'saude_desporto_lazer_per_capta' ~ 'Saúde, Desporto e Lazer',
    insumo == 'urbanismo_habitacao_transporte_seguranca_agricultura_per_capta' ~ 'Urbanismo, Transporte e Segurança',
    insumo == 'outros_per_capta' ~ 'Outros')) 

mapa_produtos <- municipios %>% 
  dplyr::left_join(base, by = c('code_muni' = 'id_municipio')) %>% 
  tidyr::drop_na() %>% 
  dplyr::select(code_muni,
                name_muni,
                abbrev_state,
                name_region,
                dplyr::contains('ods'),
                !geom) %>%
  as.data.frame() %>% 
  dplyr::select(name_region, 
                name_muni,
                dplyr::contains('ods')) %>% 
  tidyr::pivot_longer(cols = !c(name_region,
                                name_muni),
                      names_to = 'produto',
                      values_to = 'valor') %>% 
  dplyr::arrange(name_muni, desc(valor)) %>% 
  dplyr::mutate(produto = dplyr::case_when(
    produto == 'ods3' ~ 'ODS 3',
    produto == 'ods4' ~ 'ODS 4',
    produto == 'ods6' ~ 'ODS 6 ',
    produto == 'ods11' ~ 'ODS 11'))  

```

# INTRODUÇÃO

## Contexto

Explique o contexto da análise, mencionando a importância da eficiência dos 
gastos públicos em relação aos Objetivos de Desenvolvimento Sustentável (ODS).

## Objetivo 

O objetivo do presente relatório consiste em estruturar um indicador de 
eficiência para municípios brasileiros no processo de atendimento de Objetivos 
de Desenvolvimento Sustentável (ODS) a partir do empenho do orçamento municipal 
(alocação de recursos). Para alcançar os resultados foram realizadas as seguintes 
etapas:

- Seleção de municípios brasileiros;

- Levantamento e análise do orçamento municipal recente;

- Levantamento e análise dos índices de atendimento municipal 
aos ODS;

- Estruturação de um indicador de eficiência orçamentária 
municipal que relaciona empenho orçamentário e atendimento aos
ODS;

- Mensuração do nível de eficiência alcançado por cada município;

- Análise comparativa dos resultados.

Assim, busca-se a partir deste objetivo destacar áreas de melhoria na gestão 
pública para promover o desenvolvimento sustentável e fornecer insights 
relevantes para pautar políticas públicas mais eficazes, visando alcançar avanços 
significativos em direção aos ODS no país.

# MÉTODO DE PESQUISA

## Seleção de Municípios 

Com a finalidade de realizar a análise comparativa de eficiência orçamentária em
relação aos ODS dos municípios brasileiros, foi necessário definir um critério 
de seleção de municípios de modo a garatir que a amostra fosse minimamente 
homogênea ao município de Itajubá-MG (foco deste relatório). Assim, definiu-se 
como critério o tamanho populacional, assumindo por hipótese que o porte do município
reflete desafios similares na formulação de políticas públicas e na gestão dos 
recursos financeiros para atendimento às demandas .

Mais especificamente, foram selecionados municípios na faixa de 75.000 a 150.000
habitantes. Este intervalo foi escolhido para representar municípios de porte médio,
os quais, em geral, enfrentam desafios típicos de cidades em desenvolvimento e, ao
mesmo tempo, possuem capacidade administrativa intermediária para implementar
políticas voltadas ao cumprimento dos ODS.

A partir do exposto, a amostra foi reduzida a 232 municípios brasileiros, sendo 
uma amostra suficientemente grande para  captar variações regionais e 
operacionais de municípios homogêneos. Ao analisar a eficiência destes municípios 
é possível identificar padrões de eficiência e, além disso,  gerar recomendações 
de boas práticas a serem implementadas. 

No dashboard abaixo é possível analisar a amostra selecionada. 

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align='center'}
mapa_total_pop <- mapa_total %>% 
  dplyr::left_join(populacao, by = c('code_muni' = 'municipio_codigo')) 


g2_amostra <- 
  ggplot() + 
  geom_sf(data = estados, 
          aes(),
          fill = 'white') + 
  geom_sf(data = mapa_total_pop, 
          aes(group = 1,
              text = paste0('Município: ', name_muni,
                            '<br>Estado: ', abbrev_state,
                            '<br>Região: ', name_region,
                            '<br>População: ', scales::number(
                              pop,
                              big.mark = '.'))),
          fill = 'white',
          size = 1,
          color = cor_base) +
  theme_minimal() + 
  theme(axis.title = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        panel.grid = element_blank()) 

g2_amostra <- plotly::ggplotly(g2_amostra, tooltip = 'text') %>% 
  plotly::config(modeBarButtonsToRemove = plotly_layout)

g2_amostra 
```

```{r echo=FALSE, fig.align='center', fig.height=3, message=FALSE, warning=FALSE}
g1_amostra <- as.data.frame(mapa_total) %>%
  dplyr::select(name_region) %>%
  table() %>% 
  as.data.frame() %>% 
  dplyr::rename('regiao' = name_region,
                'municipios' = Freq) %>%
  dplyr::mutate(regiao = as.character(regiao),
                municipios = as.numeric(municipios)) %>%
  dplyr::arrange(desc(municipios)) %>%
  dplyr::mutate(regiao = forcats::fct_reorder(regiao, municipios)) %>% 
  ggplot() + 
  geom_col(aes(y = regiao, x = municipios, group = 1,
               text = paste0('Região: ', regiao,
                             '<br>Número de Municípios:', municipios)),
           fill = cor_base) + 
  labs(y = '',
       x = 'Número de Municípios') +
  theme_minimal() +
  theme(axis.ticks = element_blank(),
        panel.grid = element_blank()) 

g1_amostra <- plotly::ggplotly(g1_amostra, tooltip = 'text') %>% 
  plotly::config(modeBarButtonsToRemove = plotly_layout)

g1_amostra
```

## Modelo Conceitual Proposto

### Análise dos Insumos

Lorem ipsum! Lorem ipsum! Lorem ipsum! Lorem ipsum! Lorem ipsum! Lorem ipsum! 

```{r echo=FALSE, fig.align='center', message=FALSE, warning=FALSE}
mapa_insumos_key <- SharedData$new(mapa_insumos)

g1_disp_insumos <- mapa_insumos_key %>%
  ggplot() +
  geom_boxplot(aes(y = valor, x = insumo)) + 
  geom_jitter(aes(y = valor, x = insumo, color = name_region, group = 1,
                  text = paste0('Município: ', name_muni,
                                '<br>Região: ', name_region,
                                '<br>Insumo: ', insumo,
                                '<br>Valor: ', scales::number(valor,
                                                              accuracy = 0.01,
                                                              decimal.mark = ',',
                                                              big.mark = '.'),
                                ' R$/Habitante')),
              size = 1) +
  scale_y_continuous(labels = scales::number_format(big.mark = '.')) +
  scale_x_discrete(labels = c('Educação e \n Cultura',
                              'Outros',
                              'Saneamento e \n Gestão Ambiental',
                              'Saúde, \n Desporto e \n Lazer',
                              'Urbanismo, \n Transporte e \n Segurança')) +
  scale_color_viridis_d() +
  labs(x = '',
       y = 'R$/Habitante',
       color = '') +
  theme_classic() +
  theme(legend.position = 'bottom',
        axis.title.x = ggtext::element_markdown(),
        axis.title.y = ggtext::element_markdown())

g1_disp_insumos <- plotly::ggplotly(g1_disp_insumos, tooltip = 'text') %>%
  plotly::layout(legend = list(orientation = 'h',
                               x = 0,
                               y = -0.25, 
                               xanchor='left',
                               yanchor='bottom')) %>%
  plotly::config(modeBarButtonsToRemove = plotly_layout)

                         
                         
bscols(widths = c(6, 6),
       filter_checkbox('regiao', 'Região:', mapa_insumos_key, ~name_region, inline = FALSE),
       list(
       filter_select('municipio', 
                     'Município:', 
                     mapa_insumos_key, 
                     ~name_muni, 
                     multiple = TRUE),
       filter_slider('valor', 
                     'Valor:', 
                     mapa_insumos_key, 
                     ~valor, 
                     min = 0, 
                     max = 70000,
                     step = 10000)))

g1_disp_insumos
```

Lorem ipsum! Lorem ipsum! Lorem ipsum! Lorem ipsum! Lorem ipsum! Lorem ipsum! 

```{r echo=FALSE, fig.align='center', message=FALSE, warning=FALSE}
tb1_insumos <- datatable(mapa_insumos_key,
                         rownames = FALSE,
                         extensions = c('Responsive'),
                         options = list(
                           dom = 'tip',
                           language = list(url = 'https://cdn.datatables.net/plug-ins/1.10.11/i18n/Portuguese-Brasil.json')),
                         colnames = c('Região',
                                      'Município',
                                      'Insumo',
                                      'Valor')) %>% 
  formatCurrency(4, 
                 currency = 'R$ ',
                 mark = '.',
                 dec.mark = ',',
                 digits = 2)

tb1_insumos
```

Lorem ipsum! Lorem ipsum! Lorem ipsum! Lorem ipsum! Lorem ipsum! Lorem ipsum! 
Lorem ipsum! Lorem ipsum! Lorem ipsum! Lorem ipsum! Lorem ipsum! Lorem ipsum! 
Lorem ipsum! Lorem ipsum! Lorem ipsum! Lorem ipsum! Lorem ipsum! Lorem ipsum! 
Lorem ipsum! Lorem ipsum! Lorem ipsum! Lorem ipsum! Lorem ipsum! Lorem ipsum! 
Lorem ipsum! Lorem ipsum! Lorem ipsum! Lorem ipsum! Lorem ipsum! Lorem ipsum! 

Lorem ipsum! Lorem ipsum! Lorem ipsum! Lorem ipsum! Lorem ipsum! Lorem ipsum! 
Lorem ipsum! Lorem ipsum! Lorem ipsum! Lorem ipsum! Lorem ipsum! Lorem ipsum! 
Lorem ipsum! Lorem ipsum! Lorem ipsum! Lorem ipsum! Lorem ipsum! Lorem ipsum! 
Lorem ipsum! Lorem ipsum! Lorem ipsum! Lorem ipsum! Lorem ipsum! Lorem ipsum! 
Lorem ipsum! Lorem ipsum! Lorem ipsum! Lorem ipsum! Lorem ipsum! Lorem ipsum! 

```{r echo=FALSE, fig.align='center', message=FALSE, warning=FALSE}
mapa_insumos_2 <- mapa_insumos
mapa_insumos_key_2 <- SharedData$new(mapa_insumos_2)

g1_box_insumos <- mapa_insumos_key_2 %>%
  ggplot() +
  geom_boxplot(aes(y = valor, x = as.factor(insumo), color = name_region)) + 
  scale_y_continuous(labels = scales::number_format(big.mark = '.')) +
  scale_x_discrete(labels = c('Educação e \n Cultura',
                              'Outros',
                              'Saneamento e \n Gestão Ambiental',
                              'Saúde, \n Desporto e \n Lazer',
                              'Urbanismo, \n Transporte e \n Segurança')) +
  scale_color_viridis_d() +
  labs(x = '',
       y = 'R$/Habitante',
       color = '') +
  theme_classic() +
  theme(legend.position = 'bottom',
        axis.title.x = ggtext::element_markdown(),
        axis.title.y = ggtext::element_markdown())

g1_box_insumos <- plotly::ggplotly(g1_box_insumos, tooltip = 'text') %>%
  plotly::layout(legend = list(orientation = 'h',
                               x = 0,
                               y = -0.25, 
                               xanchor='left',
                               yanchor='bottom')) %>%
  plotly::config(modeBarButtonsToRemove = plotly_layout)

bscols(widths = c(12),
       filter_checkbox('regiao', 'Região:', 
                       mapa_insumos_key_2, 
                       ~name_region, 
                       inline = TRUE))

g1_box_insumos
```

### Análise dos Produtos

Lorem ipsum! Lorem ipsum! Lorem ipsum! Lorem ipsum! Lorem ipsum! Lorem ipsum! 

```{r echo=FALSE, fig.align='center', message=FALSE, warning=FALSE}
mapa_produtos_key <- SharedData$new(mapa_produtos)

g1_disp_produtos <- mapa_produtos_key %>%
  ggplot() +
  geom_boxplot(aes(y = valor, x = produto)) + 
  geom_jitter(aes(y = valor, x = produto, color = name_region, group = 1,
                  text = paste0('Município: ', name_muni,
                                '<br>Região: ', name_region,
                                '<br>Produto: ', produto,
                                '<br>Valor: ', scales::number(valor,
                                                              accuracy = 0.01,
                                                              decimal.mark = ',',
                                                              big.mark = '.'))),
              size = 1) +
  scale_y_continuous(labels = scales::number_format(big.mark = '.')) +
  scale_color_viridis_d() +
  labs(y = 'Número Índice',
       x = '',
       color = '') +
  theme_classic() +
  theme(legend.position = 'bottom')

g1_disp_produtos <- plotly::ggplotly(g1_disp_produtos, tooltip = 'text') %>%
  plotly::layout(legend = list(orientation = 'h',
                               x = 0,
                               y = -0.25, 
                               xanchor='left',
                               yanchor='bottom')) %>%
  plotly::config(modeBarButtonsToRemove = plotly_layout)

                         
                         
bscols(widths = c(6, 6),
       filter_checkbox('regiao', 'Região:', mapa_produtos_key, ~name_region, inline = FALSE),
       list(
       filter_select('municipio', 
                     'Município:', 
                     mapa_produtos_key, 
                     ~name_muni, 
                     multiple = TRUE),
       filter_slider('valor', 
                     'Valor:', 
                     mapa_produtos_key, 
                     ~valor, 
                     min = 0, 
                     max = 100,
                     step = 10)))

g1_disp_produtos
```

Lorem ipsum! Lorem ipsum! Lorem ipsum! Lorem ipsum! Lorem ipsum! Lorem ipsum! 

```{r echo=FALSE, fig.align='center', message=FALSE, warning=FALSE}
tb1_produtos <- datatable(mapa_produtos_key,
                         rownames = FALSE,
                         extensions = c('Responsive'),
                         options = list(
                           dom = 'tip',
                           language = list(url = 'https://cdn.datatables.net/plug-ins/1.10.11/i18n/Portuguese-Brasil.json')),
                         colnames = c('Região',
                                      'Município',
                                      'Produto',
                                      'Valor')) %>% 
  formatRound(4, 
              mark = '.',
              dec.mark = ',',
              digits = 2)

tb1_produtos
```

Lorem ipsum! Lorem ipsum! Lorem ipsum! Lorem ipsum! Lorem ipsum! Lorem ipsum! 
Lorem ipsum! Lorem ipsum! Lorem ipsum! Lorem ipsum! Lorem ipsum! Lorem ipsum! 
Lorem ipsum! Lorem ipsum! Lorem ipsum! Lorem ipsum! Lorem ipsum! Lorem ipsum! 
Lorem ipsum! Lorem ipsum! Lorem ipsum! Lorem ipsum! Lorem ipsum! Lorem ipsum! 
Lorem ipsum! Lorem ipsum! Lorem ipsum! Lorem ipsum! Lorem ipsum! Lorem ipsum! 

Lorem ipsum! Lorem ipsum! Lorem ipsum! Lorem ipsum! Lorem ipsum! Lorem ipsum! 
Lorem ipsum! Lorem ipsum! Lorem ipsum! Lorem ipsum! Lorem ipsum! Lorem ipsum! 
Lorem ipsum! Lorem ipsum! Lorem ipsum! Lorem ipsum! Lorem ipsum! Lorem ipsum! 
Lorem ipsum! Lorem ipsum! Lorem ipsum! Lorem ipsum! Lorem ipsum! Lorem ipsum! 
Lorem ipsum! Lorem ipsum! Lorem ipsum! Lorem ipsum! Lorem ipsum! Lorem ipsum!

```{r echo=FALSE, fig.align='center', message=FALSE, warning=FALSE}
mapa_produtos_2 <- mapa_produtos
mapa_produtos_key_2 <- SharedData$new(mapa_produtos_2)

g1_box_produtos <- mapa_produtos_key_2 %>%
  ggplot() +
  geom_boxplot(aes(y = valor, x = as.factor(produto),
                   color = name_region)) + 
  scale_y_continuous(labels = scales::number_format(big.mark = '.')) +
  scale_color_viridis_d() +
  labs(y = 'Número Índice',
       x = '',
       color = '') +
  theme_classic() +
  theme(legend.position = 'bottom')

g1_box_produtos <- plotly::ggplotly(g1_box_produtos, tooltip = 'text') %>%
  plotly::layout(legend = list(orientation = 'h',
                               x = 0,
                               y = -0.25, 
                               xanchor='left',
                               yanchor='bottom')) %>%
  plotly::config(modeBarButtonsToRemove = plotly_layout)

bscols(widths = c(12),
       filter_checkbox('regiao', 'Região:', 
                       mapa_produtos_key_2, 
                       ~name_region, 
                       inline = TRUE))

g1_box_produtos

```

## Fonte de Dados

## Indicador de Eficiência

$$ \min{} \theta_0 = \sum_{i = 1}^{r} v_i \ x_{i0}$$
$$Sujeito \ à:$$
$$ \sum_{j = 1}^{s} u_j \ y_{j0} = 1 $$
$$(\sum_{i = 1}^{r} v_i \ x_{ik}) - (\sum_{j = 1}^{s} u_j \ y_{jk}) = 0, \forall  \ k$$
$$v_i, \ u_j \geq 0, \forall \ i, \ j$$
# DISCUSSÃO DE RESULTADOS

## Resultados 

## O Municipio de Itajubá

# CONCLUSÃO E RECOMENDAÇÕES

## Síntese

Resuma os principais achados sobre a eficiência dos municípios e o alcance dos ODS.

## Recomendações para o Município de Itajubá

Sugira ações que o município pode adotar com base nos benchmarks de eficiência e nos ODS.





# PARA SAIR DE VEZ









## Eficiência

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align='center'}
# eficiencia_key <- municipios %>%
#   dplyr::full_join(eficiencia, by = c('code_muni' = 'dmu')) %>%
#   dplyr::arrange(desc(score)) %>% 
#   tidyr::drop_na()
# 
# g1_eficiencia <-
#   ggplot() +
#   geom_sf(data = estados,
#           aes(),
#           fill = 'white') +
#   geom_sf(data = eficiencia_key,
#           aes(group = 1,
#               size = round(score,2),
#               color = name_region,
#               text = paste0('Município: ', name_muni,
#                             '<br>Estado: ', abbrev_state,
#                             '<br>Região: ', name_region,
#                             '<br>Eficiência: ', scales::number(score,
#                                                                accuracy = 0.01,
#                                                                decimal.mark = ',',
#                                                                big.mark = '.'))),
#           fill = 'white') +
#   scale_color_viridis_d() +
#   scale_size(range = c(0, 2)) + 
#   labs(size = '',
#        color = '') + 
#   theme_minimal() +
#   theme(axis.title = element_blank(),
#         axis.text = element_blank(),
#         axis.ticks = element_blank(),
#         panel.grid = element_blank())
# 
# g1_eficiencia <- plotly::ggplotly(g1_eficiencia, tooltip = 'text') %>%
#   plotly::layout(legend = list(orientation = 'h',
#                                x = 0,
#                                y = -0.25, 
#                                xanchor='left',
#                                yanchor='bottom')) %>%
#   plotly::config(modeBarButtonsToRemove = plotly_layout)
# 
# g1_eficiencia

# g1_eficiencia <- eficiencia %>% 
#   ggplot() + 
#   geom_point(aes(x = produto_ponderado/insumo_ponderado, y = score))
# 
# 
# g1_eficiencia
```

























































